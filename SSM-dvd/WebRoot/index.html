<!DOCTYPE html>
<html>
  <head>
    <title>index.html</title>
	
    <meta name="keywords" content="keyword1,keyword2,keyword3">
    <meta name="description" content="this is my page">
    <meta name="content-type" content="text/html" charset="UTF-8">    
    <style>
    	.wStyle{
    		display:none;
    		background:white;
    		border:1px solid blue;
    		position:absolute;
    		top:140px;
    		left:100px;
    		padding:30px;
    	}
    	table{
    		border-collapse:collapse;    		
    	}
    </style>
	<script type="text/javascript" src="js/jquery-1.12.4.js"></script>
  </head>
  <script type="text/javascript">
  	$(function(){
  		$.getJSON("Dvdshow.do",succ);  
  		//jquery正常无法获取追加来的元素，使用以下方法		
  		$("tbody").on("click","tr td a",function(){
  			var name=$("input[name=search]").val();
  			//获取当前页
  			var title=$(this).attr("title");
  			//获取总页数
  			var pagenum=$(this).parent().find("span").last().html();
  			if(title==0){//不能点击上一页
  				alert("已经是第一页了");
  			}else if(title>pagenum){
  				alert("已经是最后一页了");
  			}else{
  				$.getJSON("Dvdshow.do",{"pno":title,"name":name},succ);
  			}
  		});
  		//查询事件
  		$("input#find").click(function(){
  			var name=$("input[name='search']").val();
  			$.getJSON("Dvdshow.do",{"name":name},succ);
  		});
  		//显示添加窗口
  		$("input#add").click(function(){
  			$("#addBox").css("display","block");
  		});
  		//添加DVD事件
  		$("input[name='addDvd']").click(function(){
  			var name=$("#addBox input[name=dname]").val();
  			$.getJSON("addDvd.do",{name:name,op:"add"},function(res){
  				if(res==1){
  					alert("添加图书成功！")
  					location.reload();//刷新当前页
  				}
  			});
  		});
  		//隐藏窗口
  		$("input[name=escDvd]").click(function(){
  			$("#addBox").css("display","none");
  			$("#updateBox").css("display","none");
  		});
  		
  		//显示修改窗口
  		$("tbody").on("click","tr td input[name=update]",function(){
  			$("#updateBox").css("display","block");
  			var dvd=$(this).attr("data");
  			dvd= JSON.parse(dvd);  			
  			$("#updateBox input[type=hidden]").attr("value",dvd.id);
  			$("#updateBox input[name=updatename]").attr("value",dvd.name);
  		});
  		//修改DVD事件
  		$("#updateBox input[name=updateDvd]").click(function(){
  			var name=$("#updateBox input[name=updatename]").val();
  			var id=$("#updateBox input[type=hidden]").val();
  			$.getJSON("updateDvd.do",{id:id,name:name,op:"update"},function(res){
  				if(res==1){
  					alert("修改图书成功！")
  					location.reload();//刷新当前页
  				}else{
  					alert("修改图书失败！")
  					location.reload();//刷新当前页
  				}
  			});
  		});
  		
  		//删除DVD时间
  		$("tbody").on("click","tr td input[name=del]",function(){  			
  			var id=$(this).attr("data");
  			$.getJSON("deleteDvd.do",{id:id,op:"del"},function(res){
  				if(res==1){
  					alert("删除DVD成功！")
  					location.reload();//刷新当前页
  				}else{
  					alert("删除DVD失败！")
  					location.reload();//刷新当前页
  				}
  			});
  		});
  		
  		//租借DVD
  		$("tbody").on("click","tr td input[name=LR]",function(){  			
  			var id=$(this).attr("data");
  			var value=$(this).val();
  			if(value=="可借"){
  				$.getJSON("lendDvd.do",{id:id,op:"lendDvd"},function(res){
	  				if(res==1){
	  					alert("借出DVD成功！")
	  					location.reload();//刷新当前页
	  				}else{
	  					alert("借出DVD失败！")
	  					location.reload();//刷新当前页
	  				}
  				});
  			}else{
  				$.getJSON("lendDvd.do",{id:id,op:"returnDvd"},function(res){
	  				if(res==1){
	  					alert("归还DVD成功！")
	  					location.reload();//刷新当前页
	  				}else{
	  					alert("归还DVD失败！")
	  					location.reload();//刷新当前页
	  				}
  				});
  			}
  			
  		});
  	});
  	function succ(mes){
  		var str="";
  		var list= mes.list;
  		if(list.length==0){
  			str+="<tr><td colspan='6'>没有查询到结果</td></tr>"
  		}
  		for(var i=0;i<list.length;i++){
  			var dvd=list[i];
  			str+="<tr>"+
  					"<td>"+dvd.id+"</td>"+
  					"<td>"+dvd.name+"</td>"+
  					"<td>"+dvd.lenttime+"</td>"+
  					"<td>"+(dvd.status==1?'可借':'借出')+"</td>"+
  					"<td>"+dvd.count+"</td>"+
  					"<td><input type='button' value='修改' name='update' data='"+JSON.stringify(dvd)+"'>&nbsp;&nbsp;"+
  					"<input type='button' value='删除' name='del' data='"+dvd.id+"'>&nbsp;&nbsp;"+	
  					"<input type='button' data='"+dvd.id+"' name='LR' value='"+(dvd.status==1?'可借':'归还')+"'></td>"+	
  				 "</tr>";
  		}
  		str+="<tr><td colspan='6'>"+
  				"<a href='JavaScript:void(0)' title='1'>首页</a>&nbsp;&nbsp;"+
  				"<a href='JavaScript:void(0)' title='"+(mes.currnetPage-1)+"'>上一页</a>&nbsp;&nbsp;"+ 
  				"<span>"+mes.currnetPage+"/</span><span>"+mes.countPage+"</span>&nbsp;&nbsp;"+ 				
  				"<a href='JavaScript:void(0)' title='"+(mes.currnetPage+1)+"'>下一页</a>&nbsp;&nbsp;"+
  				"<a href='JavaScript:void(0)' title='"+mes.countPage+"'>尾页</a>"+
  			 "</td></tr>";
  		$("tbody").empty();
  		$("tbody").append(str);
  	};
  </script>
  <body>
  	<!-- 添加DVD窗口 -->
  	<div id="addBox" class="wStyle">
  		<h1>添加DVD</h1>
  		<input type="text" name="dname"><br/>
  		<input type="button" name="addDvd" value="确定">
  		<input type="button" name="escDvd" value="取消">
  	</div>
  	<!-- 修改DVD窗口 -->
  	<div id="updateBox" class="wStyle">
  		<h1>修改DVD</h1>
  		<input type="hidden"/>
  		<input type="text" name="updatename"><br/>
  		<input type="button" name="updateDvd" value="确定">
  		<input type="button" name="escDvd" value="取消">
  	</div>
    <table border="1" cellpadding="5px">
    	<caption><h1>欢迎计入DVD管理系统</h1></caption>    	
    	<thead>
    		<tr>
    			<td colspan="6">
    				查找DVD：<input type="text" name="search" placeholder="输入要查找的DVD">
    				<input type="button" id="find" value="查找">
    				<input type="button" id="add" value="添加">
    			</td>
    		</tr>
    		<tr>
    			<td>编号</td>
   				<td>名称</td>
   				<td>借出日期</td>
   				<td>状态</td>
   				<td>借出次数</td>
   				<td>操作</td>
    		</tr>
    	</thead>
    	<tbody></tbody>
    </table>
   
  </body>
</html>
